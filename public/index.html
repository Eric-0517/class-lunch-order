<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åœ‹äºŒä¸€ä¾¿ç•¶è¨‚è³¼ç³»çµ±</title>
<link rel="stylesheet" href="style.css">
<style>
/* ====== ä½ çš„åŸæœ‰æ¨£å¼ ====== */
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #0b0f14;
  padding: 10px 20px;
}
.logo {
  font-size: 18px;
  font-weight: bold;
  color: #cfe9ff;
}
.header-buttons {
  display: flex;
  gap: 10px;
}
.btn {
  padding: 8px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
}
.btn-history { background-color: #2196f3; color: white; }
.btn-notice { background-color: #ff9800; color: white; }
.btn-login { background-color: #4caf50; color: white; }
.btn:hover { opacity: 0.9; }
main { padding: 20px; }
.day-card {
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 10px;
  margin: 10px 0;
}
.day-card h3 { margin: 0 0 10px 0; }
.summary {
  margin: 20px 0;
  font-size: 16px;
  font-weight: bold;
}
.submit-btn {
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background-color: #2196f3;
  color: white;
}
.submit-btn.locked {
  background-color: #f44336;
  cursor: not-allowed;
}
.submit-btn.locked::after {
  content: "ğŸ”’";
  margin-left: 5px;
  font-weight: bold;
}
.submit-btn:hover:not(.locked) { opacity: 0.9; }
footer {
  text-align: center;
  font-size: 0.8em;
  color: #888;
  margin: 20px 0;
}

/* ====== æ–°å¢ modal æ¨£å¼ ====== */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 999;
  justify-content: center;
  align-items: center;
}
.notification {
  background: #fff;
  border-radius: 12px;
  max-width: 500px;
  width: 90%;
  padding: 20px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.2);
  position: relative;
  animation: fadeIn .3s ease;
}
.notification__title {
  display: flex;
  align-items: center;
  font-weight: bold;
  font-size: 18px;
  margin-bottom: 15px;
  color: black;
}
.notification__title-icon {
  width: 20px;
  height: 20px;
  background: #ff9800;
  border-radius: 50%;
  margin-right: 8px;
}
.notification__content-txt {
  font-size: 15px;
  line-height: 1.6;
  color: black;
}
.notification__content-txt a {
  color: red;
  font-weight: bold;
  text-decoration: underline;
}
.rountbutton { text-align: center; margin-top: 20px; }
.rountbutton__widget {
  background: #2196f3;
  color: #fff;
  border: none;
  border-radius: 25px;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
}
.rountbutton__widget:hover { background: #1976d2; }
.notification__close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 18px;
  text-decoration: none;
  color: #888;
  cursor: pointer;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px);}
  to   { opacity: 1; transform: translateY(0);}
}
</style>
  <link rel="icon" type="image/png" href="/favicon.png?v=2">
</head>
<body>
<header>
  <div class="logo">åœ‹äºŒä¸€ä¾¿ç•¶è¨‚è³¼ç³»çµ±</div>
  <div class="header-buttons">
    <button class="btn btn-history" onclick="location.href='history.html'">æ­·å²è¨‚å–®</button>
    <button class="btn btn-notice" onclick="location.href='notice/index.html'">å…¬å‘Š</button>
    <button class="btn btn-login" onclick="location.href='admin.html'">å¾Œå°ç™»å…¥</button>
  </div>
</header>

<main>
  <label>åº§è™Ÿï¼š
    <select id="seat-select">
      <option value="">è«‹é¸æ“‡åº§è™Ÿ</option>
    </select>
  </label>

  <div id="days-container"></div>

  <div class="summary">
    ç¸½é‡‘é¡ï¼š<span id="total-price">0</span> å…ƒ
  </div>

  <button id="submit-order" class="submit-btn">é€å‡ºè¨‚å–®</button>
</main>

<!-- ğŸ”” å…¬å‘Š Modal -->
<div class="modal-overlay" id="modal">
  <div class="notification">
    <div class="notification__title">
      <div class="notification__title-icon"></div>
      <div class="notification__title-txt">å³æ™‚å…¬å‘Š(9/23æ—¥)</div>
    </div>
    <div class="notification__content">
      <div class="notification__content-txt">
        <p>åŒå­¸ï¼Œæ‚¨å¥½ï¼š</p>
        <p>(9/23æ—¥å…¬å‘Š)ç›®å‰è¨‚è³¼ç³»çµ±å·²é€²è¡Œä¿®å¾©ï¼Œå¤§è‡´ä¸Šå·²å®Œæˆï¼Œä¸éé‚„æœªç¢ºèªè³‡æ–™æ˜¯å¦æœƒæ¶ˆå¤±é‚„éœ€é€²è¡Œæ¸¬è©¦ï¼Œæ¸¬è©¦æ™‚é–“å¤§ç´„å°‡ç‚ºæœŸä¸€é€±ã€‚</p>
        <p>åœ¨æ­¤æœŸé–“å…§å°‡è¦–æƒ…æ³èª¿æ•´æœ¬ç³»çµ±ï¼Œæ¸¬è©¦æœŸé–“è³‡æ–™å°‡ä¸è¨ˆå…¥è«‹åŒå­¸ç„¡é ˆæ“”å¿ƒï¼</p>
        <p>ç›®å‰è¨‚è³¼æš«ä¸”æ›´æ”¹ç‚º Google è¡¨å–®è¨‚è³¼ï¼š<br>
        <a href="https://forms.gle/bfKNo6z2663YgaE78" target="_blank">å‰å¾€è¨‚è³¼è¡¨å–®</a></p>
        <p>å¦‚é€ æˆå›°æ“¾é‚„è«‹è¦‹è«’ï¼</p>
        <p>æ›´å¤šè©³ç´°èªªæ˜è«‹åƒè€ƒï¼š<a href="https://lunchorder.dpdns.org/notice/Post/250921.html" target="_blank">0921ç³»çµ±æš«åœä½¿ç”¨å…¬å‘Š</a></p>
      </div>
    </div>
    <div class="rountbutton">
      <button class="rountbutton__widget" onclick="closeModal()">æˆ‘çŸ¥é“äº†ï¼</button>
    </div>
    <a class="notification__close" onclick="closeModal()">âœ•</a>
  </div>
</div>

<script>
/* === åº§è™Ÿé¸å–®èˆ‡ä¾¿ç•¶é¸é … === */
const seatSelect = document.getElementById('seat-select');
for(let i=1;i<=32;i++){
  const opt = document.createElement('option');
  opt.value = i;
  opt.textContent = i;
  seatSelect.appendChild(opt);
}

const daysContainer = document.getElementById('days-container');
const dayNames = ['ç¦®æ‹œä¸€','ç¦®æ‹œäºŒ','ç¦®æ‹œä¸‰','ç¦®æ‹œå››','ç¦®æ‹œäº”'];
const types = ['æ­£åœ’A','æ­£åœ’B','å¾¡é¥ŒA','å¾¡é¥ŒB','æ‚¦é¦¨','ä»Šæ—¥ä¸è¨‚è³¼'];

dayNames.forEach(day=>{
  const card = document.createElement('div');
  card.className='day-card';
  card.dataset.day=day;
  card.innerHTML = `<h3>${day}</h3>` +
    types.map(type=>`
       <label>
         <input type="radio" name="${day}" value="${type}">
         ${type}
       </label>
     `).join('');
  daysContainer.appendChild(card);
});

/* === ç¸½é‡‘é¡è¨ˆç®— === */
function updateTotal(){
  const items=[];
  document.querySelectorAll('.day-card').forEach(card=>{
    const checked = card.querySelector('input[type=radio]:checked');
    items.push({ typeName: checked ? checked.value : 'ä»Šæ—¥ä¸è¨‚è³¼', quantity:1 });
  });
  const total = items.reduce((sum,i)=>sum + (i.typeName==='ä»Šæ—¥ä¸è¨‚è³¼'?0:70),0);
  document.getElementById('total-price').textContent=total;
}
document.addEventListener('change',updateTotal);

/* === é€å–®æŒ‰éˆ•é–å®š === */
const submitBtn = document.getElementById('submit-order');

async function updateSubmitButton() {
  try {
    const res = await fetch('/api/orderMode');
    const data = await res.json();
    if(data.success && data.data.open){
      submitBtn.classList.remove('locked');
      submitBtn.disabled = false;
    } else {
      submitBtn.classList.add('locked');
      submitBtn.disabled = true;
    }
  } catch(e){
    submitBtn.classList.remove('locked');
    submitBtn.disabled = false;
  }
}
// é é¢è¼‰å…¥æ™‚æª¢æŸ¥é€å–®ç‹€æ…‹
updateSubmitButton();
// æ¯åˆ†é˜è‡ªå‹•æª¢æŸ¥ä¸€æ¬¡é€å–®ç‹€æ…‹
setInterval(updateSubmitButton, 60*1000);

/* === é€å–®åŠŸèƒ½ === */
submitBtn.addEventListener('click', async ()=>{
  if(submitBtn.disabled) return;
  const seat = seatSelect.value;
  if(!seat) return alert("è«‹é¸æ“‡åº§è™Ÿ");

  const items=[];
  document.querySelectorAll('.day-card').forEach(card=>{
    const checked = card.querySelector('input[type=radio]:checked');
    items.push({ 
      day: card.dataset.day,
      typeName: checked ? checked.value : 'ä»Šæ—¥ä¸è¨‚è³¼',
      quantity: 1
    });
  });

  const totalPrice = items.reduce((sum,i)=>sum + (i.typeName==='ä»Šæ—¥ä¸è¨‚è³¼'?0:70),0);
  if(!confirm(`ç¢ºèªä¾¿ç•¶æ˜¯å¦è¨‚è³¼ç„¡èª¤ï¼Ÿ\nå…±è¨ˆé‡‘é¡ï¼š${totalPrice} å…ƒ`)) return;

  try{
    const res = await fetch('/api/order',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({seat,items})
    });
    const data = await res.json();
    if(data.success){
      document.querySelectorAll('input[type=radio]').forEach(r=>r.checked=false);
      document.getElementById('total-price').textContent=0;
      alert("è¨‚è³¼æˆåŠŸï¼\nè«‹è‡³æ­·å²è¨‚å–®é é¢æŸ¥çœ‹ï¼");
    } else {
      alert("è¨‚å–®é€å‡ºå¤±æ•—ï¼š" + (data.message || "æœªçŸ¥éŒ¯èª¤"));
    }
  }catch(err){
    console.error("è¨‚å–®é€å‡ºå¤±æ•—ï¼š" + err.message);
  }
});

/* === Modal é–‹é—œ === */
function openModal() {
  document.getElementById('modal').style.display = 'flex';
}
function closeModal() {
  document.getElementById('modal').style.display = 'none';
}
window.onload = openModal;
</script>

<footer>
  â€»å¦‚é‡éŒ¯èª¤é é¢åˆ·æ–°å³å¯ï¼Œéœ€æ›´æ”¹ä¾¿ç•¶æ•¸é‡æˆ–å…¶ä»–æ±è¥¿è«‹æ‰¾ç›¸é—œè‚¡é•·è™•ç†ï¼Œbugåé¥‹/è¯ç¹«æ–¹å¼(Gmail)ï¼šs11316021@fsvs.khc.edu.tw
</footer>
</body>
</html>
